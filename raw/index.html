<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Danh s√°ch t·ªáp - tnhan.dev/raw/</title>
  <style>
    :root { --radius: 10px; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    h1 { margin: 0 0 8px; font-size: 20px; }
    .sub { color: #666; margin-bottom: 16px; }
    .controls { display: flex; gap: 8px; margin: 16px 0; flex-wrap: wrap; }
    input[type="search"] {
      padding: 10px 12px; border: 1px solid #ddd; border-radius: var(--radius); min-width: 260px;
    }
    select { padding: 10px 12px; border: 1px solid #ddd; border-radius: var(--radius); }
    .card {
      border: 1px solid #eee; border-radius: var(--radius); overflow: hidden;
    }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px; border-bottom: 1px dashed #eee; text-align: left; vertical-align: middle; }
    th { background: #fafafa; font-weight: 600; }
    tr:hover td { background: #fcfcfc; }
    .path { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; word-break: break-all; }
    .btn {
      padding: 8px 10px; border: 1px solid #ddd; border-radius: 8px; background: #fff; cursor: pointer;
    }
    .btn:hover { background: #f6f6f6; }
    .chip {
      display: inline-block; padding: 4px 8px; border: 1px solid #eee; border-radius: 999px; font-size: 12px; color: #555;
    }
    .footer { color: #888; font-size: 12px; margin-top: 16px; }
    .toast {
      position: fixed; inset: auto 16px 16px auto; background: #111; color: #fff;
      padding: 10px 12px; border-radius: 8px; opacity: 0; transform: translateY(8px);
      transition: all .25s ease; pointer-events: none; z-index: 9999;
    }
    .toast.show { opacity: 1; transform: translateY(0); }
    .empty { text-align: center; color: #777; padding: 24px; }
  </style>
</head>
<body>
  <h1>Danh s√°ch t·ªáp t·∫°i <code>tnhan.dev/raw/</code></h1>
  <div class="sub">T·ª± ƒë·ªông qu√©t th∆∞ m·ª•c <code>/raw</code> trong repo <code>ntnhwn/tnhanx.github.io</code> b·∫±ng GitHub API.</div>

  <div class="controls">
    <input id="q" type="search" placeholder="T√¨m theo t√™n / ph·∫ßn m·ªü r·ªông (vd: .pdf, .png, .zip)..." />
    <select id="extFilter">
      <option value="">L·ªçc ph·∫ßn m·ªü r·ªông</option>
      <option>.pdf</option><option>.png</option><option>.jpg</option><option>.jpeg</option>
      <option>.gif</option><option>.svg</option><option>.webp</option><option>.txt</option>
      <option>.md</option><option>.zip</option><option>.rar</option><option>.7z</option>
      <option>.json</option><option>.csv</option><option>.html</option><option>.css</option><option>.js</option>
    </select>
    <button id="refresh" class="btn" title="T·∫£i l·∫°i danh s√°ch">üîÑ T·∫£i l·∫°i</button>
  </div>

  <div class="card">
    <table id="table">
      <thead>
        <tr>
          <th>File</th>
          <th>ƒê∆∞·ªùng d·∫´n</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td class="empty" colspan="3">ƒêang t·∫£i danh s√°ch t·ªáp‚Ä¶</td></tr>
      </tbody>
    </table>
  </div>

  <div class="footer">Ngu·ªìn: GitHub API (trees, branch <code>main</code>). Li√™n k·∫øt ƒë∆∞·ª£c copy theo d·∫°ng <code>https://tnhan.dev/raw/&lt;path&gt;</code>.</div>
  <div id="toast" class="toast">ƒê√£ copy!</div>

  <script>
    // C·∫•u h√¨nh repo & base URL public
    const OWNER = "ntnhwn";
    const REPO  = "tnhanx.github.io";
    const BRANCH = "main";
    const ROOT_DIR = "raw/"; // ch·ªâ l·∫•y file b√™n trong th∆∞ m·ª•c n√†y
    const PUBLIC_BASE = "https://tnhan.dev/raw/"; // link ƒë·ªÉ copy

    const $ = (sel) => document.querySelector(sel);
    const tbody = $("#tbody");
    const toast = $("#toast");
    const q = $("#q");
    const extFilter = $("#extFilter");
    const refreshBtn = $("#refresh");

    let allFiles = [];

    function showToast(msg = "ƒê√£ copy!") {
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 1500);
    }

    function isUnderRaw(path) {
      return path.startsWith(ROOT_DIR) && !path.endsWith("/"); // lo·∫°i folder
    }

    function render(list) {
      if (!list.length) {
        tbody.innerHTML = `<tr><td class="empty" colspan="3">Kh√¥ng c√≥ t·ªáp ph√π h·ª£p.</td></tr>`;
        return;
      }
      const rows = list.map(item => {
        const relative = item.path.slice(ROOT_DIR.length); // ph·∫ßn sau 'raw/'
        const viewUrl = PUBLIC_BASE + relative;           // URL public
        const safeUrl = encodeURI(viewUrl);               // gi·ªØ nguy√™n d·∫•u '/' nh∆∞ng encode k√Ω t·ª± ƒë·∫∑c bi·ªát
        const fileName = relative.split("/").pop();

        return `
          <tr>
            <td>
              <div class="path">${fileName}</div>
              <div class="chip" title="ƒê∆∞·ªùng d·∫´n t∆∞∆°ng ƒë·ªëi trong /raw">${relative.includes("/") ? relative.split("/").slice(0,-1).join("/") : "."}</div>
            </td>
            <td class="path">${relative}</td>
            <td>
              <a class="btn" href="${safeUrl}" target="_blank" rel="noopener">üîó M·ªü</a>
              <button class="btn" data-copy="${safeUrl}">üìã Copy link</button>
            </td>
          </tr>`;
      }).join("");
      tbody.innerHTML = rows;

      // G√°n s·ª± ki·ªán copy
      tbody.querySelectorAll("button[data-copy]").forEach(btn => {
        btn.addEventListener("click", async (e) => {
          const url = e.currentTarget.getAttribute("data-copy");
          try {
            await navigator.clipboard.writeText(url);
            showToast("ƒê√£ copy li√™n k·∫øt!");
          } catch {
            // fallback
            const ta = document.createElement("textarea");
            ta.value = url; document.body.appendChild(ta);
            ta.select(); document.execCommand("copy"); ta.remove();
            showToast("ƒê√£ copy li√™n k·∫øt!");
          }
        });
      });
    }

    function applyFilter() {
      const text = q.value.trim().toLowerCase();
      const ext = extFilter.value;
      let list = allFiles;

      if (text) {
        list = list.filter(it => it.path.toLowerCase().includes(text));
      }
      if (ext) {
        list = list.filter(it => it.path.toLowerCase().endsWith(ext.toLowerCase()));
      }
      render(list);
    }

    async function fetchFiles() {
      tbody.innerHTML = `<tr><td class="empty" colspan="3">ƒêang t·∫£i danh s√°ch t·ªáp‚Ä¶</td></tr>`;
      allFiles = [];
      // D√πng Git Trees API ƒë·ªÉ l·∫•y to√†n b·ªô c√¢y th∆∞ m·ª•c (ƒë√£ recursive)
      const url = `https://api.github.com/repos/${OWNER}/${REPO}/git/trees/${encodeURIComponent(BRANCH)}?recursive=1`;
      try {
        const res = await fetch(url, {
          headers: {
            "Accept": "application/vnd.github+json"
          }
        });
        if (!res.ok) {
          throw new Error(`GitHub API error: ${res.status}`);
        }
        const data = await res.json();
        // L·ªçc ch·ªâ file (blob) d∆∞·ªõi th∆∞ m·ª•c raw/
        allFiles = (data.tree || [])
          .filter(node => node.type === "blob" && isUnderRaw(node.path))
          .map(node => ({ path: node.path })); // c√≥ th·ªÉ th√™m size: node.size n·∫øu c·∫ßn

        // S·∫Øp x·∫øp theo t√™n t·ªáp (a-z)
        allFiles.sort((a, b) => a.path.localeCompare(b.path, undefined, { sensitivity: "base" }));

        applyFilter();
      } catch (err) {
        console.error(err);
        tbody.innerHTML = `<tr><td class="empty" colspan="3">Kh√¥ng t·∫£i ƒë∆∞·ª£c danh s√°ch (c√≥ th·ªÉ do rate limit). Th·ª≠ l·∫°i sau.</td></tr>`;
      }
    }

    // S·ª± ki·ªán
    q.addEventListener("input", applyFilter);
    extFilter.addEventListener("change", applyFilter);
    refreshBtn.addEventListener("click", fetchFiles);

    // Kh·ªüi ƒë·ªông
    fetchFiles();
  </script>
</body>
</html>
